<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="format-detection" content="telephone=no">
    <title>SOCCER Stars Challenge</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            -webkit-tap-highlight-color: transparent;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
            padding: 10px;
            overflow-x: hidden;
            touch-action: manipulation;
            -webkit-touch-callout: none;
            -webkit-user-select: none;
            user-select: none;
        }

        .game-container {
            background: white;
            border-radius: 20px;
            padding: 20px;
            max-width: 800px;
            width: 100%;
            max-height: 100vh;
            overflow-y: auto;
            -webkit-overflow-scrolling: touch;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
            animation: slideIn 0.5s ease-out;
        }

        @media (max-width: 768px) {
            .game-container {
                padding: 15px;
                border-radius: 15px;
                max-height: 100vh;
            }
        }

        @keyframes slideIn {
            from {
                opacity: 0;
                transform: translateY(-20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .title {
            text-align: center;
            color: #2d3748;
            margin-bottom: 20px;
            font-size: 2em;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.1);
            font-weight: bold;
        }

        @media (max-width: 768px) {
            .title {
                font-size: 1.5em;
            }
        }

        .soccer-ball {
            display: inline-block;
            animation: bounce 2s infinite;
        }

        @keyframes bounce {
            0%, 100% { transform: translateY(0); }
            50% { transform: translateY(-10px); }
        }

        .score-bar {
            background: linear-gradient(90deg, #48bb78 0%, #38a169 100%);
            color: white;
            padding: 12px;
            border-radius: 10px;
            margin-bottom: 15px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            font-size: 1.1em;
            font-weight: 600;
            flex-wrap: wrap;
            gap: 10px;
        }

        @media (max-width: 768px) {
            .score-bar {
                font-size: 1em;
                padding: 10px;
            }
        }

        .stars {
            font-size: 1.5em;
        }

        .intro-screen, .game-screen, .end-screen, .minigame-screen {
            display: none;
        }

        .intro-screen.active, .game-screen.active, .end-screen.active, .minigame-screen.active {
            display: block;
            animation: fadeIn 0.5s ease-out;
        }

        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }

        .rules-list {
            background: #f8f9fa;
            border-radius: 15px;
            padding: 20px;
            margin: 15px 0;
            border: 1px solid #e2e8f0;
        }

        @media (max-width: 768px) {
            .rules-list {
                padding: 15px;
            }
        }

        .rule-item {
            padding: 15px;
            margin: 12px 0;
            background: white;
            border-radius: 10px;
            border-left: 5px solid #4299e1;
            transition: transform 0.3s;
            font-size: 1.05em;
            line-height: 1.6;
        }

        @media (max-width: 768px) {
            .rule-item {
                padding: 12px;
                font-size: 0.95em;
            }
        }

        .rule-item:hover {
            transform: translateX(5px);
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
        }

        .rule-letter {
            font-size: 1.4em;
            color: #4299e1;
            font-weight: bold;
        }

        .btn {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            padding: 16px 32px;
            font-size: 1.1em;
            font-weight: 600;
            border-radius: 50px;
            cursor: pointer;
            transition: all 0.3s;
            margin: 8px;
            font-family: inherit;
            box-shadow: 0 4px 15px rgba(102, 126, 234, 0.4);
            min-height: 48px;
            -webkit-appearance: none;
            -moz-appearance: none;
            appearance: none;
            touch-action: manipulation;
        }

        @media (max-width: 768px) {
            .btn {
                padding: 14px 28px;
                font-size: 1em;
                min-height: 44px;
                width: 90%;
                max-width: 300px;
            }
        }

        .btn:hover {
            transform: translateY(-3px);
            box-shadow: 0 6px 20px rgba(102, 126, 234, 0.5);
        }

        .btn:active {
            transform: translateY(0);
        }

        .scenario-box {
            background: linear-gradient(135deg, #e0f2f1 0%, #b2dfdb 100%);
            border-radius: 15px;
            padding: 20px;
            margin: 15px 0;
            min-height: 140px;
        }

        .scenario-title {
            color: #00695c;
            font-size: 1.25em;
            margin-bottom: 12px;
            font-weight: bold;
            line-height: 1.4;
        }

        .scenario-text {
            color: #1a202c;
            font-size: 1.05em;
            line-height: 1.7;
            font-weight: 500;
        }

        @media (max-width: 768px) {
            .scenario-box {
                padding: 15px;
            }
            
            .scenario-title {
                font-size: 1.15em;
            }
            
            .scenario-text {
                font-size: 1em;
            }
        }

        .choices {
            display: grid;
            gap: 12px;
            margin-top: 15px;
        }

        @media (max-width: 768px) {
            .choices {
                gap: 10px;
            }
        }

        .choice-btn {
            background: white;
            border: 3px solid #4299e1;
            color: #1a202c;
            padding: 16px 20px;
            font-size: 1.05em;
            font-weight: 600;
            border-radius: 12px;
            cursor: pointer;
            transition: all 0.3s;
            text-align: left;
            font-family: inherit;
            line-height: 1.5;
            min-height: 60px;
            display: flex;
            align-items: center;
        }

        @media (max-width: 768px) {
            .choice-btn {
                padding: 14px 16px;
                font-size: 0.95em;
                min-height: 56px;
            }
        }

        .choice-btn:hover {
            background: #4299e1;
            color: white;
            transform: scale(1.02);
        }

        .choice-btn.correct {
            background: #48bb78;
            color: white;
            border-color: #48bb78;
            animation: correctPulse 0.5s;
        }

        .choice-btn.incorrect {
            background: #fc8181;
            color: white;
            border-color: #fc8181;
            animation: shake 0.5s;
        }

        @keyframes correctPulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.1); }
        }

        @keyframes shake {
            0%, 100% { transform: translateX(0); }
            25% { transform: translateX(-10px); }
            75% { transform: translateX(10px); }
        }

        .feedback {
            margin-top: 15px;
            padding: 16px;
            border-radius: 12px;
            font-size: 1.05em;
            line-height: 1.6;
            font-weight: 600;
            display: none;
        }

        @media (max-width: 768px) {
            .feedback {
                padding: 14px;
                font-size: 0.95em;
            }
        }

        .feedback.show {
            display: block;
            animation: slideIn 0.3s ease-out;
        }

        .feedback.correct {
            background: #c6f6d5;
            color: #22543d;
            border: 2px solid #48bb78;
        }

        .feedback.incorrect {
            background: #fed7d7;
            color: #742a2a;
            border: 2px solid #fc8181;
        }

        .progress-bar {
            width: 100%;
            height: 32px;
            background: #e2e8f0;
            border-radius: 15px;
            overflow: hidden;
            margin: 15px 0;
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #48bb78 0%, #38a169 100%);
            transition: width 0.5s ease-out;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: bold;
            font-size: 0.95em;
        }

        @media (max-width: 768px) {
            .progress-bar {
                height: 28px;
            }
            
            .progress-fill {
                font-size: 0.85em;
            }
        }

        .center-content {
            text-align: center;
        }

        /* Game Field Styles */
        .game-field {
            background: linear-gradient(to bottom, #4ade80 0%, #22c55e 100%);
            border-radius: 15px;
            padding: 15px;
            margin: 15px auto;
            position: relative;
            height: 380px;
            max-width: 600px;
            border: 3px solid #16a34a;
            overflow: hidden;
            touch-action: none;
        }

        @media (max-width: 768px) {
            .game-field {
                height: 320px;
                padding: 10px;
                margin: 10px auto;
            }
        }
        
        @media (max-width: 480px) {
            .game-field {
                height: 300px;
            }
        }

        .character {
            position: absolute;
            font-size: 2.2em;
            cursor: pointer;
            transition: all 0.3s;
            user-select: none;
            -webkit-user-select: none;
            -webkit-tap-highlight-color: transparent;
            touch-action: manipulation;
        }

        @media (max-width: 768px) {
            .character {
                font-size: 2em;
                min-width: 44px;
                min-height: 44px;
                display: flex;
                align-items: center;
                justify-content: center;
            }
        }

        .character:hover {
            transform: scale(1.2);
        }

        .character.correct {
            animation: correctBounce 0.5s;
        }

        .character.incorrect {
            animation: wrongShake 0.5s;
            filter: grayscale(1);
        }

        @keyframes correctBounce {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.5); filter: brightness(1.5); }
        }

        @keyframes wrongShake {
            0%, 100% { transform: translateX(0) rotate(0deg); }
            25% { transform: translateX(-10px) rotate(-5deg); }
            75% { transform: translateX(10px) rotate(5deg); }
        }

        .minigame-title {
            text-align: center;
            color: #1a202c;
            font-size: 1.6em;
            margin-bottom: 10px;
            font-weight: bold;
            line-height: 1.3;
        }

        .minigame-instructions {
            text-align: center;
            color: #2d3748;
            margin-bottom: 15px;
            font-size: 1.05em;
            background: #f0f4f8;
            padding: 12px;
            border-radius: 10px;
            font-weight: 600;
            line-height: 1.5;
        }

        @media (max-width: 768px) {
            .minigame-title {
                font-size: 1.3em;
            }
            
            .minigame-instructions {
                font-size: 0.95em;
                padding: 10px;
            }
        }

        .timer-bar {
            width: 100%;
            height: 10px;
            background: #e2e8f0;
            border-radius: 5px;
            overflow: hidden;
            margin: 10px 0;
        }

        .timer-fill {
            height: 100%;
            background: linear-gradient(90deg, #ef4444 0%, #dc2626 100%);
            transition: width 0.1s linear;
        }

        /* Sound wave animation */
        .sound-wave {
            position: absolute;
            font-size: 1.5em;
            animation: soundPulse 1s infinite;
        }

        @keyframes soundPulse {
            0%, 100% { transform: scale(1); opacity: 1; }
            50% { transform: scale(1.5); opacity: 0.5; }
        }

        .floating {
            animation: float 3s ease-in-out infinite;
        }

        @keyframes float {
            0%, 100% { transform: translateY(0); }
            50% { transform: translateY(-20px); }
        }
        
        .combo-text {
            position: absolute;
            font-size: 2em;
            font-weight: bold;
            color: gold;
            animation: comboFloat 1s ease-out;
            pointer-events: none;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
        }
        
        @keyframes comboFloat {
            0% { transform: translateY(0); opacity: 1; }
            100% { transform: translateY(-50px); opacity: 0; }
        }

        .trophy {
            font-size: 4em;
            animation: spin 2s linear infinite;
        }

        @keyframes spin {
            from { transform: rotate(0deg); }
            to { transform: rotate(360deg); }
        }

        .final-score {
            font-size: 1.8em;
            color: #4299e1;
            margin: 20px 0;
            font-weight: bold;
        }

        .badge {
            display: inline-block;
            background: gold;
            color: #744210;
            padding: 10px 16px;
            border-radius: 20px;
            font-weight: bold;
            margin: 8px 5px;
            box-shadow: 0 4px 10px rgba(255, 215, 0, 0.5);
            font-size: 0.95em;
        }

        @media (max-width: 768px) {
            .final-score {
                font-size: 1.5em;
            }
            
            .badge {
                padding: 8px 14px;
                font-size: 0.85em;
                margin: 6px 4px;
            }
        }

        /* Better touch targets for mobile */
        .touch-target {
            min-width: 60px;
            min-height: 60px;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        /* Visual feedback for touches */
        .touch-feedback {
            position: absolute;
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background: rgba(255, 255, 255, 0.5);
            pointer-events: none;
            animation: touchRipple 0.6s ease-out;
        }

        @keyframes touchRipple {
            0% {
                transform: scale(0);
                opacity: 1;
            }
            100% {
                transform: scale(3);
                opacity: 0;
            }
        }
    </style>
</head>
<body>
    <div class="game-container">
        <h1 class="title"><span class="soccer-ball">‚öΩ</span> SOCCER Stars Challenge</h1>
        
        <!-- Intro Screen -->
        <div class="intro-screen active">
            <div class="rules-list">
                <h2 style="text-align: center; color: #1a202c; margin-bottom: 20px; font-size: 1.4em;">Learn the SOCCER Rules!</h2>
                
                <div style="text-align: center; background: #e3f2fd; padding: 10px; border-radius: 10px; margin-bottom: 15px;">
                    <strong>üì± HOW TO PLAY:</strong><br>
                    Answer questions ‚Üí Play fun mini-games ‚Üí Master the rules!<br>
                    <span style="color: #1976d2;">Works great on iPhone & iPad! Just TAP to play!</span>
                </div>
                
                <div class="rule-item">
                    <span class="rule-letter">S</span> - <strong>Stay in Your Role</strong> üìç
                    <br>Stick to your position and let everyone do their job!
                </div>
                
                <div class="rule-item">
                    <span class="rule-letter">O</span> - <strong>Open on the Field, Closed Mouth</strong> ü§ê
                    <br>Be ready for passes, but quiet when coaches talk!
                </div>
                
                <div class="rule-item">
                    <span class="rule-letter">C</span> - <strong>Stay Calm When Things Go Wrong</strong> üßò
                    <br>Take a deep breath when frustrated!
                </div>
                
                <div class="rule-item">
                    <span class="rule-letter">C</span> - <strong>Control Your Body and Play Fair</strong> ‚úã
                    <br>Use skills, not pushes! Keep everyone safe!
                </div>
                
                <div class="rule-item">
                    <span class="rule-letter">E</span> - <strong>Encourage Teammates After Mistakes</strong> üëè
                    <br>Say "Good try!" and "Next time!" Be supportive!
                </div>
                
                <div class="rule-item">
                    <span class="rule-letter">R</span> - <strong>Respect Everyone</strong> ü§ù
                    <br>Show respect to both teams, refs, and coaches!
                </div>
            </div>
            
            <div class="center-content">
                <button class="btn" onclick="startGame()">Start Challenge! ‚öΩ</button>
            </div>
        </div>

        <!-- Game Screen (Q&A) -->
        <div class="game-screen">
            <div class="score-bar">
                <div>Score: <span id="score">0</span>/200</div>
                <div class="stars" id="stars">‚≠ê‚≠ê‚≠ê‚≠ê‚≠ê</div>
                <div>Level <span id="questionNum">1</span>/20</div>
            </div>

            <div class="progress-bar">
                <div class="progress-fill" id="progress" style="width: 5%">5%</div>
            </div>

            <div class="scenario-box">
                <div class="scenario-title" id="scenarioTitle">Scenario 1</div>
                <div class="scenario-text" id="scenarioText">Loading...</div>
            </div>

            <div class="choices" id="choices">
                <!-- Choices will be added dynamically -->
            </div>

            <div class="feedback" id="feedback">
                <!-- Feedback will be shown here -->
            </div>

            <div class="center-content">
                <button class="btn" id="nextBtn" style="display: none;" onclick="proceedToMinigame()">Practice This Rule! ‚Üí</button>
            </div>
        </div>

        <!-- Minigame Screen -->
        <div class="minigame-screen">
            <div class="score-bar">
                <div>Score: <span id="minigameScore">0</span>/200</div>
                <div class="stars" id="minigameStars">‚≠ê‚≠ê‚≠ê‚≠ê‚≠ê</div>
                <div>Practice Game!</div>
            </div>

            <h2 class="minigame-title" id="minigameTitle">Practice Time!</h2>
            <p class="minigame-instructions" id="minigameInstructions">Instructions</p>
            
            <div class="timer-bar" id="timerBar" style="display: none;">
                <div class="timer-fill" id="timerFill" style="width: 100%"></div>
            </div>

            <div class="game-field" id="gameField">
                <!-- Game content will be added dynamically -->
            </div>

            <div class="center-content">
                <button class="btn" id="continueBtn" style="display: none;" onclick="nextQuestion()">Next Challenge ‚Üí</button>
            </div>
        </div>

        <!-- End Screen -->
        <div class="end-screen">
            <div class="center-content">
                <div class="trophy">üèÜ</div>
                <h2 style="color: #1a202c; margin: 20px 0; font-size: 1.6em;">Challenge Complete!</h2>
                <div class="final-score">Final Score: <span id="finalScore">0</span>/200</div>
                <div id="badges"></div>
                <div style="margin: 20px 0; color: #2d3748; font-size: 1.05em; font-weight: 600; line-height: 1.5;" id="finalMessage"></div>
                <button class="btn" onclick="location.reload()">Play Again! ‚öΩ</button>
            </div>
        </div>
    </div>

    <script>
        let currentQuestion = 0;
        let score = 0;
        let answeredCurrentQuestion = false;
        let currentRule = '';
        let minigameTimer = null;

        const scenarios = [
            {
                title: "‚öΩ Position Time!",
                text: "Coach tells you to play defense today, but you really want to score goals. What do you do?",
                rule: "S",
                choices: [
                    { text: "Run up to score anyway - goals are more fun!", correct: false },
                    { text: "Stay in defense like coach said and do your best there!", correct: true },
                    { text: "Argue with the coach about changing positions", correct: false }
                ],
                feedback: {
                    correct: "Awesome! You remembered 'S - Stay in Your Role!' Every position is important! üìç",
                    incorrect: "Remember 'S - Stay in Your Role!' Trust your coach and stick to your position! üìç"
                }
            },
            {
                title: "üó£Ô∏è Coach is Talking",
                text: "During halftime, coach is explaining the game plan. Your friend starts telling you a funny joke. What should you do?",
                rule: "O",
                choices: [
                    { text: "Listen to the joke and laugh - it's halftime fun time!", correct: false },
                    { text: "Tell your friend to be quiet and pay attention to coach", correct: true },
                    { text: "Start your own conversation about the first half", correct: false }
                ],
                feedback: {
                    correct: "Perfect! 'O - Open on field, Closed Mouth!' When coach talks, we listen! ü§ê",
                    incorrect: "Remember 'O - Open on field, Closed Mouth!' Keep quiet when coach is talking! ü§ê"
                }
            },
            {
                title: "üò§ Bad Call?",
                text: "The referee calls you offside, but you don't think you were. You feel really frustrated. What's the best response?",
                rule: "C1",
                choices: [
                    { text: "Yell at the referee that they're wrong", correct: false },
                    { text: "Take a deep breath and get back in position", correct: true },
                    { text: "Kick the ball away in anger", correct: false }
                ],
                feedback: {
                    correct: "Great job! 'C - Stay Calm When Things Go Wrong!' Deep breaths help! üßò",
                    incorrect: "Remember 'C - Stay Calm When Things Go Wrong!' Take a deep breath! üßò"
                }
            },
            {
                title: "‚ö° Going for the Ball",
                text: "An opponent has the ball and you're chasing them. They're a bit faster than you. What should you do?",
                rule: "C2",
                choices: [
                    { text: "Push them from behind to slow them down", correct: false },
                    { text: "Grab their shirt to stop them", correct: false },
                    { text: "Use your positioning and footwork to try to win the ball", correct: true }
                ],
                feedback: {
                    correct: "Excellent! 'C - Control Your Body and Play Fair!' Skills over fouls! ‚úã",
                    incorrect: "Remember 'C - Control Your Body and Play Fair!' Use skills, not pushes! ‚úã"
                }
            },
            {
                title: "üò¢ Teammate's Mistake",
                text: "Your teammate misses an easy goal and looks really upset. What do you say?",
                rule: "E",
                choices: [
                    { text: "\"How did you miss that?! It was so easy!\"", correct: false },
                    { text: "\"Good try! You'll get the next one!\"", correct: true },
                    { text: "Say nothing and look disappointed", correct: false }
                ],
                feedback: {
                    correct: "Fantastic! 'E - Encourage Teammates After Mistakes!' Great sportsmanship! üëè",
                    incorrect: "Remember 'E - Encourage Teammates After Mistakes!' Be supportive! üëè"
                }
            },
            {
                title: "üéØ On the Field Again",
                text: "You're open for a pass during the game. The coach is also giving instructions. What do you do?",
                rule: "O",
                choices: [
                    { text: "Yell loudly for the ball while coach is talking", correct: false },
                    { text: "Get in position quietly and raise your hand for the ball", correct: true },
                    { text: "Run to a different position without listening", correct: false }
                ],
                feedback: {
                    correct: "Nice work! 'O - Open on Field, Closed Mouth!' Perfect balance! ü§ê",
                    incorrect: "Remember 'O - Open on Field, Closed Mouth!' Be ready but respectful! ü§ê"
                }
            },
            {
                title: "üèÉ After the Goal",
                text: "The other team scores a goal. One of their players celebrates near you. How do you react?",
                rule: "R",
                choices: [
                    { text: "Push them away from your area", correct: false },
                    { text: "Say something mean about their celebration", correct: false },
                    { text: "Let them celebrate and focus on the restart", correct: true }
                ],
                feedback: {
                    correct: "Outstanding! 'R - Respect Everyone!' Even the other team! ü§ù",
                    incorrect: "Remember 'R - Respect Everyone!' This includes the other team! ü§ù"
                }
            },
            {
                title: "ü•Ö Goalkeeper Error",
                text: "Your goalkeeper lets in an easy goal. The whole team is disappointed. What's the right thing to do?",
                rule: "E",
                choices: [
                    { text: "Tell them \"It's okay, shake it off! Let's go!\"", correct: true },
                    { text: "Roll your eyes and shake your head", correct: false },
                    { text: "Tell them they should have saved it", correct: false }
                ],
                feedback: {
                    correct: "Perfect! 'E - Encourage Teammates After Mistakes!' True team spirit! üëè",
                    incorrect: "Remember 'E - Encourage Teammates After Mistakes!' Support your team! üëè"
                }
            },
            {
                title: "üéÆ Playing Your Position",
                text: "You're playing midfielder but you see the striker's position is open and looks fun. What do you do?",
                rule: "S",
                choices: [
                    { text: "Stay in midfield and do your job well", correct: true },
                    { text: "Move to striker without asking", correct: false },
                    { text: "Complain loudly that you want to play striker", correct: false }
                ],
                feedback: {
                    correct: "Excellent! 'S - Stay in Your Role!' Team player award! üìç",
                    incorrect: "Remember 'S - Stay in Your Role!' Every position matters! üìç"
                }
            },
            {
                title: "üí™ Tough Opponent",
                text: "You're defending against a really skilled player who keeps getting past you. You're getting frustrated. What now?",
                rule: "C1",
                choices: [
                    { text: "Trip them the next time they try", correct: false },
                    { text: "Take a breath and keep trying your best with good defense", correct: true },
                    { text: "Get angry and play more aggressively", correct: false }
                ],
                feedback: {
                    correct: "Amazing! You used 'C - Stay Calm!' Deep breaths and keep trying! üßò",
                    incorrect: "Remember 'C - Stay Calm When Things Go Wrong!' Breathe and refocus! üßò"
                }
            }
        ];

        const minigames = {
            'S': {
                title: "Position Keeper!",
                instructions: "üì± SWIPE or TAP the arrows to collect balls in YOUR zone (blue). Avoid red zones!",
                setup: setupPositionKeeperGame
            },
            'O': {
                title: "Listen & Play!",
                instructions: "üì± When coach speaks (üó£Ô∏è), TAP 'LISTEN'. When playing (‚öΩ), TAP 'CALL FOR BALL'!",
                setup: setupListenAndPlayGame
            },
            'C1': {
                title: "Calm Down Challenge!",
                instructions: "üì± TAP the breathing circle when it's BIG to stay calm after bad calls!",
                setup: setupCalmDownGame
            },
            'C2': {
                title: "Fair Play Dribble!",
                instructions: "üì± SWIPE to dribble around cones. Don't knock them over!",
                setup: setupFairPlayDribbleGame
            },
            'E': {
                title: "Team Spirit!",
                instructions: "üì± TAP teammates to give encouragement when they make mistakes!",
                setup: setupTeamSpiritGame
            },
            'R': {
                title: "Respect Rally!",
                instructions: "üì± Choose respectful actions after each play!",
                setup: setupRespectRallyGame
            }
        };

        function startGame() {
            document.querySelector('.intro-screen').classList.remove('active');
            document.querySelector('.game-screen').classList.add('active');
            loadQuestion();
        }

        function loadQuestion() {
            answeredCurrentQuestion = false;
            const scenario = scenarios[currentQuestion];
            currentRule = scenario.rule;
            
            document.getElementById('questionNum').textContent = (currentQuestion * 2) + 1;
            document.getElementById('scenarioTitle').textContent = scenario.title;
            document.getElementById('scenarioText').textContent = scenario.text;
            
            const choicesDiv = document.getElementById('choices');
            choicesDiv.innerHTML = '';
            
            const shuffled = [...scenario.choices].sort(() => Math.random() - 0.5);
            
            shuffled.forEach((choice) => {
                const btn = document.createElement('button');
                btn.className = 'choice-btn';
                btn.textContent = choice.text;
                
                addTapHandler(btn, () => checkAnswer(choice, btn, scenario));
                
                choicesDiv.appendChild(btn);
            });
            
            document.getElementById('feedback').className = 'feedback';
            document.getElementById('feedback').textContent = '';
            document.getElementById('nextBtn').style.display = 'none';
        }

        function checkAnswer(choice, btn, scenario) {
            if (answeredCurrentQuestion) return;
            answeredCurrentQuestion = true;
            
            const allButtons = document.querySelectorAll('.choice-btn');
            
            allButtons.forEach(button => {
                button.style.pointerEvents = 'none';
            });
            
            if (choice.correct) {
                btn.classList.add('correct');
                score += 10;
                document.getElementById('score').textContent = score;
                showFeedback(true, scenario.feedback.correct);
            } else {
                btn.classList.add('incorrect');
                showFeedback(false, scenario.feedback.incorrect);
                
                allButtons.forEach(button => {
                    const correctChoice = scenario.choices.find(c => c.correct);
                    if (button.textContent === correctChoice.text) {
                        button.classList.add('correct');
                    }
                });
            }
            
            updateStars();
            document.getElementById('nextBtn').style.display = 'inline-block';
        }

        function showFeedback(isCorrect, message) {
            const feedback = document.getElementById('feedback');
            feedback.className = `feedback show ${isCorrect ? 'correct' : 'incorrect'}`;
            feedback.textContent = message;
        }

        function proceedToMinigame() {
            document.querySelector('.game-screen').classList.remove('active');
            document.querySelector('.minigame-screen').classList.add('active');
            
            const ruleKey = currentRule === 'C1' ? 'C1' : currentRule === 'C2' ? 'C2' : currentRule;
            const game = minigames[ruleKey];
            
            document.getElementById('minigameTitle').textContent = game.title;
            document.getElementById('minigameInstructions').textContent = game.instructions;
            document.getElementById('minigameScore').textContent = score;
            document.getElementById('continueBtn').style.display = 'none';
            
            game.setup();
        }

        // Helper function for touch/click compatibility
        function addTapHandler(element, handler) {
            let touchFired = false;
            
            element.addEventListener('touchstart', function(e) {
                e.preventDefault();
                touchFired = true;
                handler.call(this, e);
            }, { passive: false });
            
            element.addEventListener('click', function(e) {
                if (!touchFired) {
                    handler.call(this, e);
                }
                touchFired = false;
            });
        }

        // Visual touch feedback
        function createTouchFeedback(x, y, parent) {
            const feedback = document.createElement('div');
            feedback.className = 'touch-feedback';
            feedback.style.left = x + 'px';
            feedback.style.top = y + 'px';
            parent.appendChild(feedback);
            setTimeout(() => feedback.remove(), 600);
        }

        // NEW: Position Keeper Game (S - Stay in Your Role)
        function setupPositionKeeperGame() {
            const field = document.getElementById('gameField');
            field.innerHTML = '';
            
            let collected = 0;
            let wrongZone = 0;
            let playerX = 50;
            
            // Create zones
            const zones = ['LEFT (RED)', 'CENTER (YOUR ZONE)', 'RIGHT (RED)'];
            zones.forEach((zone, i) => {
                const zoneDiv = document.createElement('div');
                zoneDiv.style.position = 'absolute';
                zoneDiv.style.left = (i * 33) + '%';
                zoneDiv.style.top = '0';
                zoneDiv.style.width = '33%';
                zoneDiv.style.height = '100%';
                zoneDiv.style.borderRight = i < 2 ? '2px dashed white' : 'none';
                zoneDiv.style.background = i === 1 ? 'rgba(66, 153, 225, 0.3)' : 'rgba(255, 0, 0, 0.15)';
                
                const label = document.createElement('div');
                label.style.position = 'absolute';
                label.style.left = '5px';
                label.style.top = '5px';
                label.style.color = 'white';
                label.style.fontWeight = 'bold';
                label.style.fontSize = '0.9em';
                label.textContent = zone;
                zoneDiv.appendChild(label);
                
                field.appendChild(zoneDiv);
            });
            
            // Player
            const player = document.createElement('div');
            player.className = 'character';
            player.textContent = 'üßë‚Äç‚öΩ';
            player.style.left = playerX + '%';
            player.style.bottom = '20px';
            player.style.fontSize = '2.5em';
            player.style.transform = 'translateX(-50%)';
            field.appendChild(player);
            
            // Controls
            const leftBtn = document.createElement('button');
            leftBtn.className = 'touch-target';
            leftBtn.innerHTML = '‚¨ÖÔ∏è<br>LEFT';
            leftBtn.style.position = 'absolute';
            leftBtn.style.left = '10px';
            leftBtn.style.bottom = '20px';
            leftBtn.style.padding = '10px';
            leftBtn.style.fontSize = '1.2em';
            leftBtn.style.background = '#4299e1';
            leftBtn.style.color = 'white';
            leftBtn.style.border = 'none';
            leftBtn.style.borderRadius = '10px';
            leftBtn.style.fontWeight = 'bold';
            
            const rightBtn = document.createElement('button');
            rightBtn.className = 'touch-target';
            rightBtn.innerHTML = '‚û°Ô∏è<br>RIGHT';
            rightBtn.style.position = 'absolute';
            rightBtn.style.right = '10px';
            rightBtn.style.bottom = '20px';
            rightBtn.style.padding = '10px';
            rightBtn.style.fontSize = '1.2em';
            rightBtn.style.background = '#4299e1';
            rightBtn.style.color = 'white';
            rightBtn.style.border = 'none';
            rightBtn.style.borderRadius = '10px';
            rightBtn.style.fontWeight = 'bold';
            
            addTapHandler(leftBtn, (e) => {
                playerX = Math.max(10, playerX - 15);
                player.style.left = playerX + '%';
                createTouchFeedback(e.pageX || 50, e.pageY || 50, document.body);
            });
            
            addTapHandler(rightBtn, (e) => {
                playerX = Math.min(90, playerX + 15);
                player.style.left = playerX + '%';
                createTouchFeedback(e.pageX || 50, e.pageY || 50, document.body);
            });
            
            field.appendChild(leftBtn);
            field.appendChild(rightBtn);
            
            // Create falling balls
            function createBall() {
                const ball = document.createElement('div');
                ball.className = 'character';
                ball.textContent = '‚öΩ';
                ball.style.left = (10 + Math.random() * 80) + '%';
                ball.style.top = '0';
                ball.style.fontSize = '2em';
                ball.style.transition = 'top 2s linear';
                field.appendChild(ball);
                
                setTimeout(() => {
                    ball.style.top = '100%';
                }, 100);
                
                const checkCatch = setInterval(() => {
                    const ballX = parseFloat(ball.style.left);
                    const ballY = parseFloat(ball.style.top);
                    
                    if (ballY > 75 && ballY < 90) {
                        if (Math.abs(ballX - playerX) < 10) {
                            clearInterval(checkCatch);
                            ball.remove();
                            
                            if (playerX > 33 && playerX < 66) {
                                collected++;
                                score += 2;
                                document.getElementById('minigameScore').textContent = score;
                                
                                const msg = document.createElement('div');
                                msg.textContent = '‚úÖ In your zone!';
                                msg.className = 'combo-text';
                                msg.style.left = playerX + '%';
                                msg.style.bottom = '100px';
                                field.appendChild(msg);
                                setTimeout(() => msg.remove(), 1000);
                            } else {
                                wrongZone++;
                                
                                const msg = document.createElement('div');
                                msg.textContent = '‚ùå Wrong zone!';
                                msg.style.position = 'absolute';
                                msg.style.left = playerX + '%';
                                msg.style.bottom = '100px';
                                msg.style.color = 'red';
                                msg.style.fontWeight = 'bold';
                                msg.style.transform = 'translateX(-50%)';
                                field.appendChild(msg);
                                setTimeout(() => msg.remove(), 1000);
                            }
                        }
                    }
                    
                    if (ballY >= 95) {
                        clearInterval(checkCatch);
                        ball.remove();
                    }
                }, 50);
            }
            
            const ballInterval = setInterval(createBall, 1500);
            
            setTimeout(() => {
                clearInterval(ballInterval);
                showMinigameComplete(`Collected ${collected} in your zone! ${wrongZone === 0 ? 'Perfect positioning!' : 'Remember: Stay in your zone!'}`);
            }, 10000);
        }

        // NEW: Listen & Play Game (O - Open/Closed Mouth)
        function setupListenAndPlayGame() {
            const field = document.getElementById('gameField');
            field.innerHTML = '';
            
            let correctActions = 0;
            let mistakes = 0;
            let isCoachTalking = false;
            
            // Coach/Game indicator
            const indicator = document.createElement('div');
            indicator.style.position = 'absolute';
            indicator.style.top = '30%';
            indicator.style.left = '50%';
            indicator.style.transform = 'translateX(-50%)';
            indicator.style.fontSize = '4em';
            indicator.style.textAlign = 'center';
            field.appendChild(indicator);
            
            // Status text
            const statusText = document.createElement('div');
            statusText.style.position = 'absolute';
            statusText.style.top = '50%';
            statusText.style.left = '50%';
            statusText.style.transform = 'translate(-50%, -50%)';
            statusText.style.fontSize = '1.5em';
            statusText.style.fontWeight = 'bold';
            statusText.style.color = 'white';
            statusText.style.textAlign = 'center';
            field.appendChild(statusText);
            
            // Action buttons
            const listenBtn = document.createElement('button');
            listenBtn.className = 'touch-target';
            listenBtn.innerHTML = 'üëÇ<br>LISTEN';
            listenBtn.style.position = 'absolute';
            listenBtn.style.left = '25%';
            listenBtn.style.bottom = '20%';
            listenBtn.style.transform = 'translateX(-50%)';
            listenBtn.style.padding = '15px 25px';
            listenBtn.style.fontSize = '1.3em';
            listenBtn.style.background = '#10b981';
            listenBtn.style.color = 'white';
            listenBtn.style.border = 'none';
            listenBtn.style.borderRadius = '15px';
            listenBtn.style.fontWeight = 'bold';
            
            const callBtn = document.createElement('button');
            callBtn.className = 'touch-target';
            callBtn.innerHTML = 'üôã<br>CALL FOR BALL';
            callBtn.style.position = 'absolute';
            callBtn.style.right = '25%';
            callBtn.style.bottom = '20%';
            callBtn.style.transform = 'translateX(50%)';
            callBtn.style.padding = '15px 25px';
            callBtn.style.fontSize = '1.3em';
            callBtn.style.background = '#4299e1';
            callBtn.style.color = 'white';
            callBtn.style.border = 'none';
            callBtn.style.borderRadius = '15px';
            callBtn.style.fontWeight = 'bold';
            
            function updateStatus() {
                isCoachTalking = Math.random() > 0.5;
                
                if (isCoachTalking) {
                    indicator.textContent = 'üó£Ô∏è';
                    statusText.textContent = 'Coach is talking!';
                    statusText.style.color = '#fbbf24';
                } else {
                    indicator.textContent = '‚öΩ';
                    statusText.textContent = 'Game is on!';
                    statusText.style.color = '#10b981';
                }
            }
            
            addTapHandler(listenBtn, (e) => {
                createTouchFeedback(e.pageX || 50, e.pageY || 50, document.body);
                
                if (isCoachTalking) {
                    correctActions++;
                    score += 2;
                    document.getElementById('minigameScore').textContent = score;
                    
                    const msg = document.createElement('div');
                    msg.textContent = '‚úÖ Good listening!';
                    msg.className = 'combo-text';
                    msg.style.left = '50%';
                    msg.style.top = '70%';
                    field.appendChild(msg);
                    setTimeout(() => msg.remove(), 1000);
                } else {
                    mistakes++;
                    
                    const msg = document.createElement('div');
                    msg.textContent = '‚ùå Game is on! Call for ball!';
                    msg.style.position = 'absolute';
                    msg.style.left = '50%';
                    msg.style.top = '70%';
                    msg.style.transform = 'translateX(-50%)';
                    msg.style.color = 'red';
                    msg.style.fontWeight = 'bold';
                    field.appendChild(msg);
                    setTimeout(() => msg.remove(), 1000);
                }
            });
            
            addTapHandler(callBtn, (e) => {
                createTouchFeedback(e.pageX || 50, e.pageY || 50, document.body);
                
                if (!isCoachTalking) {
                    correctActions++;
                    score += 2;
                    document.getElementById('minigameScore').textContent = score;
                    
                    const msg = document.createElement('div');
                    msg.textContent = '‚úÖ Good call!';
                    msg.className = 'combo-text';
                    msg.style.left = '50%';
                    msg.style.top = '70%';
                    field.appendChild(msg);
                    setTimeout(() => msg.remove(), 1000);
                } else {
                    mistakes++;
                    
                    const msg = document.createElement('div');
                    msg.textContent = '‚ùå Shh! Coach is talking!';
                    msg.style.position = 'absolute';
                    msg.style.left = '50%';
                    msg.style.top = '70%';
                    msg.style.transform = 'translateX(-50%)';
                    msg.style.color = 'red';
                    msg.style.fontWeight = 'bold';
                    field.appendChild(msg);
                    setTimeout(() => msg.remove(), 1000);
                }
            });
            
            field.appendChild(listenBtn);
            field.appendChild(callBtn);
            
            updateStatus();
            const statusInterval = setInterval(updateStatus, 2500);
            
            setTimeout(() => {
                clearInterval(statusInterval);
                showMinigameComplete(`${correctActions} correct actions! ${mistakes === 0 ? 'Perfect timing!' : 'Remember: Listen when coach talks, call when playing!'}`);
            }, 10000);
        }

        // NEW: Calm Down Game (C1 - Stay Calm)
        function setupCalmDownGame() {
            const field = document.getElementById('gameField');
            field.innerHTML = '';
            
            let calmBreaths = 0;
            let missedBreaths = 0;
            let breathSize = 1;
            let growing = true;
            
            // Bad call scenario
            const scenario = document.createElement('div');
            scenario.style.position = 'absolute';
            scenario.style.top = '10%';
            scenario.style.width = '100%';
            scenario.style.textAlign = 'center';
            scenario.style.fontSize = '1.3em';
            scenario.style.fontWeight = 'bold';
            scenario.style.color = 'white';
            field.appendChild(scenario);
            
            // Breathing circle
            const breathCircle = document.createElement('div');
            breathCircle.style.position = 'absolute';
            breathCircle.style.left = '50%';
            breathCircle.style.top = '50%';
            breathCircle.style.transform = 'translate(-50%, -50%)';
            breathCircle.style.width = '100px';
            breathCircle.style.height = '100px';
            breathCircle.style.border = '5px solid #4299e1';
            breathCircle.style.borderRadius = '50%';
            breathCircle.style.display = 'flex';
            breathCircle.style.alignItems = 'center';
            breathCircle.style.justifyContent = 'center';
            breathCircle.style.background = 'rgba(66, 153, 225, 0.2)';
            breathCircle.style.cursor = 'pointer';
            breathCircle.style.fontSize = '1.2em';
            breathCircle.style.fontWeight = 'bold';
            breathCircle.style.color = '#4299e1';
            breathCircle.textContent = 'TAP';
            field.appendChild(breathCircle);
            
            // Instructions
            const inst = document.createElement('div');
            inst.style.position = 'absolute';
            inst.style.bottom = '20%';
            inst.style.width = '100%';
            inst.style.textAlign = 'center';
            inst.style.color = 'white';
            inst.style.fontWeight = 'bold';
            inst.textContent = 'TAP when the circle is BIG to take a deep breath!';
            field.appendChild(inst);
            
            const badCalls = [
                "‚ùå Referee calls offside!",
                "‚ùå Yellow card for you!",
                "‚ùå Penalty against your team!",
                "‚ùå Goal disallowed!",
                "‚ùå Foul called on you!"
            ];
            
            let currentCall = 0;
            
            function showBadCall() {
                if (currentCall < badCalls.length) {
                    scenario.textContent = badCalls[currentCall];
                    currentCall++;
                }
            }
            
            showBadCall();
            const callInterval = setInterval(showBadCall, 2000);
            
            // Breathing animation
            const breathInterval = setInterval(() => {
                if (growing) {
                    breathSize += 0.02;
                    if (breathSize >= 1.5) {
                        growing = false;
                    }
                } else {
                    breathSize -= 0.02;
                    if (breathSize <= 0.8) {
                        growing = true;
                        missedBreaths++;
                    }
                }
                
                breathCircle.style.transform = `translate(-50%, -50%) scale(${breathSize})`;
                
                if (breathSize >= 1.3) {
                    breathCircle.style.background = 'rgba(16, 185, 129, 0.3)';
                    breathCircle.style.borderColor = '#10b981';
                    breathCircle.textContent = 'NOW!';
                } else {
                    breathCircle.style.background = 'rgba(66, 153, 225, 0.2)';
                    breathCircle.style.borderColor = '#4299e1';
                    breathCircle.textContent = 'WAIT';
                }
            }, 50);
            
            addTapHandler(breathCircle, (e) => {
                createTouchFeedback(e.pageX || 50, e.pageY || 50, document.body);
                
                if (breathSize >= 1.3) {
                    calmBreaths++;
                    score += 3;
                    document.getElementById('minigameScore').textContent = score;
                    
                    const msg = document.createElement('div');
                    msg.textContent = 'üòå Good breath! Stay calm!';
                    msg.className = 'combo-text';
                    msg.style.left = '50%';
                    msg.style.top = '30%';
                    field.appendChild(msg);
                    setTimeout(() => msg.remove(), 1000);
                    
                    breathSize = 0.8;
                    growing = true;
                } else {
                    const msg = document.createElement('div');
                    msg.textContent = '‚è∞ Wait for it to grow!';
                    msg.style.position = 'absolute';
                    msg.style.left = '50%';
                    msg.style.top = '30%';
                    msg.style.transform = 'translateX(-50%)';
                    msg.style.color = 'yellow';
                    msg.style.fontWeight = 'bold';
                    field.appendChild(msg);
                    setTimeout(() => msg.remove(), 1000);
                }
            });
            
            setTimeout(() => {
                clearInterval(breathInterval);
                clearInterval(callInterval);
                showMinigameComplete(`${calmBreaths} calm breaths taken! ${missedBreaths < 3 ? 'Great emotional control!' : 'Remember: Deep breaths help you stay calm!'}`);
            }, 10000);
        }

        // NEW: Fair Play Dribble Game (C2 - Control Your Body)
        function setupFairPlayDribbleGame() {
            const field = document.getElementById('gameField');
            field.innerHTML = '';
            
            let playerX = 50;
            let playerY = 80;
            let score_local = 0;
            let fouls = 0;
            
            // Player with ball
            const player = document.createElement('div');
            player.className = 'character';
            player.textContent = '‚öΩ';
            player.style.left = playerX + '%';
            player.style.top = playerY + '%';
            player.style.fontSize = '2.5em';
            player.style.transform = 'translate(-50%, -50%)';
            player.id = 'dribblePlayer';
            field.appendChild(player);
            
            // Create cones to dribble around
            const cones = [];
            for (let i = 0; i < 5; i++) {
                const cone = document.createElement('div');
                cone.className = 'character';
                cone.textContent = 'üî∫';
                cone.style.left = (20 + i * 15) + '%';
                cone.style.top = (30 + (i % 2) * 20) + '%';
                cone.style.fontSize = '2em';
                cone.style.transform = 'translate(-50%, -50%)';
                cone.dataset.passed = 'false';
                cones.push(cone);
                field.appendChild(cone);
            }
            
            // Swipe controls indicator
            const swipeHint = document.createElement('div');
            swipeHint.style.position = 'absolute';
            swipeHint.style.bottom = '10px';
            swipeHint.style.width = '100%';
            swipeHint.style.textAlign = 'center';
            swipeHint.style.color = 'white';
            swipeHint.style.fontWeight = 'bold';
            swipeHint.innerHTML = 'üëÜ SWIPE or use ARROWS to dribble around cones!';
            field.appendChild(swipeHint);
            
            // Arrow buttons for mobile
            const leftBtn = document.createElement('button');
            leftBtn.className = 'touch-target';
            leftBtn.textContent = '‚¨ÖÔ∏è';
            leftBtn.style.position = 'absolute';
            leftBtn.style.left = '10px';
            leftBtn.style.bottom = '50%';
            leftBtn.style.padding = '15px';
            leftBtn.style.fontSize = '2em';
            leftBtn.style.background = 'rgba(66, 153, 225, 0.8)';
            leftBtn.style.color = 'white';
            leftBtn.style.border = 'none';
            leftBtn.style.borderRadius = '10px';
            
            const rightBtn = document.createElement('button');
            rightBtn.className = 'touch-target';
            rightBtn.textContent = '‚û°Ô∏è';
            rightBtn.style.position = 'absolute';
            rightBtn.style.right = '10px';
            rightBtn.style.bottom = '50%';
            rightBtn.style.padding = '15px';
            rightBtn.style.fontSize = '2em';
            rightBtn.style.background = 'rgba(66, 153, 225, 0.8)';
            rightBtn.style.color = 'white';
            rightBtn.style.border = 'none';
            rightBtn.style.borderRadius = '10px';
            
            const upBtn = document.createElement('button');
            upBtn.className = 'touch-target';
            upBtn.textContent = '‚¨ÜÔ∏è';
            upBtn.style.position = 'absolute';
            upBtn.style.left = '50%';
            upBtn.style.top = '10px';
            upBtn.style.transform = 'translateX(-50%)';
            upBtn.style.padding = '15px';
            upBtn.style.fontSize = '2em';
            upBtn.style.background = 'rgba(66, 153, 225, 0.8)';
            upBtn.style.color = 'white';
            upBtn.style.border = 'none';
            upBtn.style.borderRadius = '10px';
            
            function movePlayer(dx, dy) {
                playerX = Math.max(10, Math.min(90, playerX + dx));
                playerY = Math.max(10, Math.min(90, playerY + dy));
                player.style.left = playerX + '%';
                player.style.top = playerY + '%';
                
                // Check cone collisions
                cones.forEach(cone => {
                    const coneX = parseFloat(cone.style.left);
                    const coneY = parseFloat(cone.style.top);
                    
                    if (Math.abs(playerX - coneX) < 8 && Math.abs(playerY - coneY) < 8) {
                        if (cone.dataset.passed === 'false') {
                            cone.dataset.passed = 'true';
                            cone.textContent = '‚úÖ';
                            score_local++;
                            score += 2;
                            document.getElementById('minigameScore').textContent = score;
                            
                            const msg = document.createElement('div');
                            msg.textContent = '‚öΩ Nice dribble!';
                            msg.className = 'combo-text';
                            msg.style.left = coneX + '%';
                            msg.style.top = coneY + '%';
                            field.appendChild(msg);
                            setTimeout(() => msg.remove(), 1000);
                        }
                    }
                });
            }
            
            addTapHandler(leftBtn, () => movePlayer(-10, 0));
            addTapHandler(rightBtn, () => movePlayer(10, 0));
            addTapHandler(upBtn, () => movePlayer(0, -10));
            
            field.appendChild(leftBtn);
            field.appendChild(rightBtn);
            field.appendChild(upBtn);
            
            // Touch/swipe handling
            let touchStartX = null;
            let touchStartY = null;
            
            field.addEventListener('touchstart', (e) => {
                touchStartX = e.touches[0].clientX;
                touchStartY = e.touches[0].clientY;
            }, { passive: true });
            
            field.addEventListener('touchend', (e) => {
                if (!touchStartX || !touchStartY) return;
                
                const touchEndX = e.changedTouches[0].clientX;
                const touchEndY = e.changedTouches[0].clientY;
                
                const dx = touchEndX - touchStartX;
                const dy = touchEndY - touchStartY;
                
                if (Math.abs(dx) > Math.abs(dy)) {
                    movePlayer(dx > 0 ? 10 : -10, 0);
                } else {
                    movePlayer(0, dy > 0 ? 10 : -10);
                }
                
                touchStartX = null;
                touchStartY = null;
            }, { passive: true });
            
            setTimeout(() => {
                showMinigameComplete(`Dribbled past ${score_local} cones! ${fouls === 0 ? 'Perfect ball control!' : 'Remember: Use skill, not force!'}`);
            }, 10000);
        }

        // NEW: Team Spirit Game (E - Encourage)
        function setupTeamSpiritGame() {
            const field = document.getElementById('gameField');
            field.innerHTML = '';
            
            let encouraged = 0;
            let missed = 0;
            
            const mistakes = [
                { emoji: 'üò¢', text: 'Missed goal!' },
                { emoji: 'üòî', text: 'Bad pass!' },
                { emoji: 'üòû', text: 'Lost ball!' },
                { emoji: 'üòü', text: 'Own goal!' },
                { emoji: 'üò£', text: 'Penalty miss!' }
            ];
            
            function createUpsetPlayer() {
                const mistake = mistakes[Math.floor(Math.random() * mistakes.length)];
                
                const container = document.createElement('div');
                container.style.position = 'absolute';
                container.style.left = (10 + Math.random() * 70) + '%';
                container.style.top = (10 + Math.random() * 60) + '%';
                container.style.textAlign = 'center';
                container.style.cursor = 'pointer';
                
                const player = document.createElement('div');
                player.className = 'character';
                player.textContent = mistake.emoji;
                player.style.fontSize = '3em';
                container.appendChild(player);
                
                const text = document.createElement('div');
                text.style.color = 'white';
                text.style.fontWeight = 'bold';
                text.style.marginTop = '5px';
                text.style.fontSize = '0.9em';
                text.textContent = mistake.text;
                container.appendChild(text);
                
                addTapHandler(container, (e) => {
                    createTouchFeedback(e.pageX || 50, e.pageY || 50, document.body);
                    
                    player.textContent = 'üòä';
                    text.textContent = 'Thanks!';
                    encouraged++;
                    score += 3;
                    document.getElementById('minigameScore').textContent = score;
                    
                    const encouragements = [
                        'üëè "Great effort!"',
                        'üí™ "You\'ll get it next time!"',
                        '‚≠ê "Keep trying!"',
                        'ü§ù "We\'re a team!"',
                        '‚ù§Ô∏è "It\'s okay!"'
                    ];
                    
                    const msg = document.createElement('div');
                    msg.textContent = encouragements[Math.floor(Math.random() * encouragements.length)];
                    msg.className = 'combo-text';
                    msg.style.left = container.style.left;
                    msg.style.top = container.style.top;
                    field.appendChild(msg);
                    setTimeout(() => msg.remove(), 1500);
                    
                    container.style.pointerEvents = 'none';
                });
                
                field.appendChild(container);
                
                setTimeout(() => {
                    if (player.textContent !== 'üòä') {
                        missed++;
                        const missMsg = document.createElement('div');
                        missMsg.textContent = '‚ùå Teammate needed support!';
                        missMsg.style.position = 'absolute';
                        missMsg.style.left = container.style.left;
                        missMsg.style.top = container.style.top;
                        missMsg.style.color = 'red';
                        missMsg.style.fontWeight = 'bold';
                        field.appendChild(missMsg);
                        setTimeout(() => missMsg.remove(), 1000);
                    }
                    container.remove();
                }, 3000);
            }
            
            const playerInterval = setInterval(createUpsetPlayer, 1800);
            
            setTimeout(() => {
                clearInterval(playerInterval);
                showMinigameComplete(`Encouraged ${encouraged} teammates! ${missed === 0 ? 'Amazing team spirit!' : 'Remember: Always support your team!'}`);
            }, 10000);
        }

        // NEW: Respect Rally Game (R - Respect)
        function setupRespectRallyGame() {
            const field = document.getElementById('gameField');
            field.innerHTML = '';
            
            let respectful = 0;
            let disrespectful = 0;
            
            const situations = [
                {
                    text: "Opponent scores a great goal!",
                    good: "üëè Applaud",
                    bad: "üò§ Complain"
                },
                {
                    text: "Referee makes a call!",
                    good: "üëç Accept it",
                    bad: "üò° Argue"
                },
                {
                    text: "Opponent helps you up!",
                    good: "ü§ù Say thanks",
                    bad: "üôÑ Ignore them"
                },
                {
                    text: "Your team wins!",
                    good: "ü§ù Shake hands",
                    bad: "üï∫ Mock dance"
                },
                {
                    text: "Coach gives feedback!",
                    good: "üëÇ Listen well",
                    bad: "üó£Ô∏è Talk back"
                }
            ];
            
            let currentSituation = 0;
            
            function showSituation() {
                field.innerHTML = '';
                
                if (currentSituation >= situations.length) {
                    showMinigameComplete(`${respectful} respectful choices! ${disrespectful === 0 ? 'Perfect sportsmanship!' : 'Remember: Respect everyone!'}`);
                    return;
                }
                
                const situation = situations[currentSituation];
                
                const text = document.createElement('div');
                text.textContent = situation.text;
                text.style.position = 'absolute';
                text.style.top = '20%';
                text.style.width = '100%';
                text.style.textAlign = 'center';
                text.style.fontSize = '1.4em';
                text.style.fontWeight = 'bold';
                text.style.color = 'white';
                field.appendChild(text);
                
                const goodBtn = document.createElement('button');
                goodBtn.className = 'touch-target';
                goodBtn.innerHTML = situation.good;
                goodBtn.style.position = 'absolute';
                goodBtn.style.left = '25%';
                goodBtn.style.top = '50%';
                goodBtn.style.transform = 'translateX(-50%)';
                goodBtn.style.padding = '20px';
                goodBtn.style.fontSize = '1.4em';
                goodBtn.style.background = '#10b981';
                goodBtn.style.color = 'white';
                goodBtn.style.border = 'none';
                goodBtn.style.borderRadius = '15px';
                goodBtn.style.fontWeight = 'bold';
                goodBtn.style.minWidth = '120px';
                
                const badBtn = document.createElement('button');
                badBtn.className = 'touch-target';
                badBtn.innerHTML = situation.bad;
                badBtn.style.position = 'absolute';
                badBtn.style.right = '25%';
                badBtn.style.top = '50%';
                badBtn.style.transform = 'translateX(50%)';
                badBtn.style.padding = '20px';
                badBtn.style.fontSize = '1.4em';
                badBtn.style.background = '#ef4444';
                badBtn.style.color = 'white';
                badBtn.style.border = 'none';
                badBtn.style.borderRadius = '15px';
                badBtn.style.fontWeight = 'bold';
                badBtn.style.minWidth = '120px';
                
                addTapHandler(goodBtn, (e) => {
                    createTouchFeedback(e.pageX || 50, e.pageY || 50, document.body);
                    respectful++;
                    score += 3;
                    document.getElementById('minigameScore').textContent = score;
                    currentSituation++;
                    
                    const msg = document.createElement('div');
                    msg.textContent = '‚úÖ Respectful choice!';
                    msg.className = 'combo-text';
                    msg.style.left = '50%';
                    msg.style.top = '80%';
                    field.appendChild(msg);
                    
                    setTimeout(showSituation, 1500);
                });
                
                addTapHandler(badBtn, (e) => {
                    createTouchFeedback(e.pageX || 50, e.pageY || 50, document.body);
                    disrespectful++;
                    currentSituation++;
                    
                    const msg = document.createElement('div');
                    msg.textContent = '‚ùå Not respectful!';
                    msg.style.position = 'absolute';
                    msg.style.left = '50%';
                    msg.style.top = '80%';
                    msg.style.transform = 'translateX(-50%)';
                    msg.style.color = 'red';
                    msg.style.fontWeight = 'bold';
                    msg.style.fontSize = '1.3em';
                    field.appendChild(msg);
                    
                    setTimeout(showSituation, 1500);
                });
                
                field.appendChild(goodBtn);
                field.appendChild(badBtn);
            }
            
            showSituation();
        }

        function showMinigameComplete(message) {
            clearInterval(minigameTimer);
            document.getElementById('timerBar').style.display = 'none';
            
            const field = document.getElementById('gameField');
            field.innerHTML = '';
            
            const msgDiv = document.createElement('div');
            msgDiv.style.position = 'absolute';
            msgDiv.style.top = '50%';
            msgDiv.style.left = '50%';
            msgDiv.style.transform = 'translate(-50%, -50%)';
            msgDiv.style.background = 'white';
            msgDiv.style.padding = '25px';
            msgDiv.style.borderRadius = '15px';
            msgDiv.style.fontSize = '1.3em';
            msgDiv.style.textAlign = 'center';
            msgDiv.style.boxShadow = '0 4px 20px rgba(0,0,0,0.2)';
            msgDiv.style.maxWidth = '90%';
            msgDiv.textContent = message;
            
            field.appendChild(msgDiv);
            
            updateStars();
            document.getElementById('continueBtn').style.display = 'inline-block';
        }

        function nextQuestion() {
            currentQuestion++;
            
            if (currentQuestion >= scenarios.length) {
                endGame();
            } else {
                document.querySelector('.minigame-screen').classList.remove('active');
                document.querySelector('.game-screen').classList.add('active');
                loadQuestion();
                updateProgress();
            }
        }

        function updateStars() {
            const percentage = (score / 200) * 100;
            let stars = '';
            
            if (percentage >= 90) stars = '‚≠ê‚≠ê‚≠ê‚≠ê‚≠ê';
            else if (percentage >= 70) stars = '‚≠ê‚≠ê‚≠ê‚≠ê';
            else if (percentage >= 50) stars = '‚≠ê‚≠ê‚≠ê';
            else if (percentage >= 30) stars = '‚≠ê‚≠ê';
            else stars = '‚≠ê';
            
            document.getElementById('stars').textContent = stars;
            if (document.getElementById('minigameStars')) {
                document.getElementById('minigameStars').textContent = stars;
            }
        }

        function updateProgress() {
            const totalLevels = scenarios.length * 2;
            const currentLevel = currentQuestion * 2;
            const progress = (currentLevel / totalLevels) * 100;
            document.getElementById('progress').style.width = progress + '%';
            document.getElementById('progress').textContent = Math.round(progress) + '%';
        }

        function endGame() {
            document.querySelector('.game-screen').classList.remove('active');
            document.querySelector('.minigame-screen').classList.remove('active');
            document.querySelector('.end-screen').classList.add('active');
            
            document.getElementById('finalScore').textContent = score;
            
            const badgesDiv = document.getElementById('badges');
            const messageDiv = document.getElementById('finalMessage');
            
            if (score >= 180) {
                badgesDiv.innerHTML = '<span class="badge">‚öΩ SOCCER Superstar!</span><span class="badge">üèÜ Perfect Player!</span><span class="badge">üéÆ Game Master!</span>';
                messageDiv.textContent = "Incredible! You've mastered ALL the SOCCER rules! You're a true champion!";
            } else if (score >= 140) {
                badgesDiv.innerHTML = '<span class="badge">‚≠ê All-Star Player!</span><span class="badge">üéØ Rule Expert!</span>';
                messageDiv.textContent = "Excellent work! You really know the SOCCER rules!";
            } else if (score >= 100) {
                badgesDiv.innerHTML = '<span class="badge">üëç Good Sport!</span>';
                messageDiv.textContent = "Nice effort! You're learning the rules well. Keep practicing!";
            } else {
                badgesDiv.innerHTML = '<span class="badge">üå± Rising Star!</span>';
                messageDiv.textContent = "Keep practicing! Every champion started somewhere. Try again!";
            }
        }
    </script>
</body>
</html>
